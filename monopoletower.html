<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Monopole Tower Calculator with Visualization</title>
<style>
    body { font-family: Arial, sans-serif; margin: 20px; display: flex; flex-direction: row; }
    .controls { width: 350px; margin-right: 20px; }
    label { display: inline-block; width: 150px; }
    input, select { margin-bottom: 10px; width: 180px; }
    button { margin-top: 10px; }
    .output { margin-top: 20px; padding: 10px; border: 1px solid #ccc; }
    canvas { border: 1px solid #000; background: #f0f0f0; }
</style>
</head>
<body>

<div class="controls">
    <h2>Monopole Tower Inputs</h2>
    <label for="height">Tower Height (m):</label>
    <input type="number" id="height" value="30" min="5"><br>

    <label for="segments">Segments:</label>
    <input type="number" id="segments" value="3" min="1"><br>

    <label for="material">Material:</label>
    <select id="material">
        <option value="steel">Steel</option>
        <option value="aluminum">Aluminum</option>
        <option value="concrete">Concrete</option>
    </select><br>

    <label for="thickness">Wall Thickness (mm):</label>
    <input type="number" id="thickness" value="5" min="1"><br>

    <label for="diameter">Base Diameter (m):</label>
    <input type="number" id="diameter" value="1.0" min="0.1" step="0.1"><br>

    <label for="wind">Wind Speed (m/s):</label>
    <input type="number" id="wind" value="30" min="0"><br>

    <label for="topLoad">Top Load (kg):</label>
    <input type="number" id="topLoad" value="100" min="0"><br>

    <button onclick="calculateAndDraw()">Calculate & Visualize</button>

    <div class="output" id="output"></div>
</div>

<canvas id="towerCanvas" width="400" height="800"></canvas>

<script>
// Material properties: density (kg/m3), yield strength (Pa), drag coefficient
const materials = {
    steel: { density: 7850, yield: 250e6, Cd: 1.2, E: 200e9 },
    aluminum: { density: 2700, yield: 95e6, Cd: 1.2, E: 70e9 },
    concrete: { density: 2400, yield: 30e6, Cd: 1.5, E: 25e9 }
};

const rho_air = 1.225;
const g = 9.81;

function calculateAndDraw() {
    // Get inputs
    const H = parseFloat(document.getElementById('height').value);
    const segments = parseInt(document.getElementById('segments').value);
    const matName = document.getElementById('material').value;
    const thickness = parseFloat(document.getElementById('thickness').value)/1000; // m
    const D = parseFloat(document.getElementById('diameter').value);
    const wind = parseFloat(document.getElementById('wind').value);
    const topLoad = parseFloat(document.getElementById('topLoad').value) * g; // N

    const mat = materials[matName];

    // Segment height
    const hSeg = H / segments;

    // Base radius
    const r_outer = D/2;
    const r_inner = r_outer - thickness;
    const area = Math.PI * (r_outer**2 - r_inner**2);

    // Forces per segment
    let cumulativeWeight = 0;
    let segmentData = [];

    for (let i=0;i<segments;i++){
        const segWeight = mat.density * g * area * hSeg; // N
        cumulativeWeight += segWeight;
        const axialLoad = cumulativeWeight + topLoad;
        const bendingForce = 0.5 * rho_air * wind**2 * mat.Cd * D * hSeg; // approx segment contribution
        const bendingMoment = bendingForce * (H - i*hSeg - hSeg/2); // moment at base of segment
        const axialStress = axialLoad / area; // Pa
        const bendingStress = bendingMoment * r_outer / (Math.PI*(r_outer**4 - r_inner**4)/4); // Pa
        // Euler Buckling Load: Pcr = π^2*E*I/(KL)^2 , K=1 for pinned-pinned, I = π*(r_o^4 - r_i^4)/4
        const I = Math.PI*(r_outer**4 - r_inner**4)/4;
        const Pcr = Math.PI**2 * mat.E * I / (hSeg**2);

        segmentData.push({
            segWeight, axialLoad, bendingForce, bendingMoment,
            axialStress, bendingStress, Pcr
        });
    }

    // Display results
    const output = document.getElementById('output');
    output.innerHTML = '<h3>Segment Results</h3>';
    segmentData.forEach((seg,i)=>{
        output.innerHTML += `
            <p><strong>Segment ${i+1}</strong><br>
            Axial Load: ${seg.axialLoad.toFixed(0)} N<br>
            Axial Stress: ${(seg.axialStress/1e6).toFixed(2)} MPa<br>
            Bending Moment: ${seg.bendingMoment.toFixed(0)} N·m<br>
            Bending Stress: ${(seg.bendingStress/1e6).toFixed(2)} MPa<br>
            Euler Buckling Load: ${seg.Pcr.toFixed(0)} N</p>
        `;
    });

    drawTower(H,D,segments,segmentData,topLoad);
}

function drawTower(H,D,segments,segmentData,topLoad){
    const canvas = document.getElementById('towerCanvas');
    const ctx = canvas.getContext('2d');
    ctx.clearRect(0,0,canvas.width,canvas.height);

    const scaleY = canvas.height / (H*1.1);
    const centerX = canvas.width/2;

    const segHeightPx = H*scaleY / segments;
    const radiusPx = D/2 * 50; // arbitrary scale for width

    // Draw segments
    segmentData.forEach((seg,i)=>{
        const y = canvas.height - (i+1)*segHeightPx;
        ctx.fillStyle = `rgba(0,100,200,0.3)`;
        ctx.fillRect(centerX - radiusPx, y, radiusPx*2, segHeightPx);

        // Draw axial force arrow
        ctx.beginPath();
        ctx.moveTo(centerX+radiusPx+10, y+segHeightPx);
        ctx.lineTo(centerX+radiusPx+10, y);
        ctx.strokeStyle='red';
        ctx.lineWidth=2;
        ctx.stroke();
        ctx.fillStyle='red';
        ctx.fillText('Axial', centerX+radiusPx+15, y+segHeightPx/2);

        // Draw bending arrow
        ctx.beginPath();
        ctx.moveTo(centerX+radiusPx+10, y+segHeightPx/2);
        ctx.lineTo(centerX+radiusPx+40, y+segHeightPx/2 + seg.bendingMoment/1e5);
        ctx.strokeStyle='green';
        ctx.lineWidth=2;
        ctx.stroke();
        ctx.fillStyle='green';
        ctx.fillText('Bending', centerX+radiusPx+45, y+segHeightPx/2);
    });

    // Top load arrow
    ctx.beginPath();
    ctx.moveTo(centerX, canvas.height - H*scaleY);
    ctx.lineTo(centerX, canvas.height - H*scaleY - topLoad/1e4);
    ctx.strokeStyle='orange';
    ctx.lineWidth=2;
    ctx.stroke();
    ctx.fillStyle='orange';
    ctx.fillText('Top Load', centerX+10, canvas.height - H*scaleY - topLoad/1e4/2);
}

</script>
</body>
</html>
